#A simple port scanner using sockets
#Author: jake-young-dev
#Requires: Python 3

#imports
import socket, ipaddress

#port scanner class
class PortScanner(object):
    #init function (runs on creation)
    def __init__(self):
        print("\n[STARTING]\n")
        self.CreateSocket()
        self.CollectHostInfo()
        self.scan()
        print("\n[EXITING]\n")
        exit()
    
    #creates socket
    def CreateSocket(self):
        try:
            self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            #set socket connection timeout to two seconds
            self.sock.settimeout(2)
            print("Socket was successfully created\n")
        except socket.error as err:
            print("There was an error creating the socket")
            print(str(err))
            print("\n[EXITING]\n")
            exit()


    #collects IP and port from user
    def CollectHostInfo(self):
        #getting IP address and port of host

        #validate IP
        self.host = input("Enter host IP: ")
        try:
            ipaddress.ip_address(self.host)
        except ValueError as err:
            print("\nThere was an error with the supplied IP address")
            print("\n[EXITING]\n")
            exit()

        #validate port
        self.port = 0
        try:
            self.port = int(input("Enter host port: "))
        except:
            print("\nThere was an error with the supplied port number")
            print("\n[EXITING]\n")
            exit()

    #scans supplied host/port
    def scan(self):
        #attempt connection
        try:
            portStatus = self.sock.connect_ex((self.host, self.port))
        except socket.gaierror as err:
            print("\nThe host specified was not found")
            print("\n[EXITING]\n")
            exit()

        #is the port open
        if portStatus:
            print("\nPort " + str(self.port) + " is closed on host " + self.host)
        else:
            print("\nPort " + str(self.port) + " is open on host " + self.host)
            

#main function
if __name__ == "__main__":
    scanner = PortScanner()